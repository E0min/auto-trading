# Round 13 교차 리뷰 -- Trader

**작성자**: Senior Quant Trader
**날짜**: 2026-02-17
**기준**: 매매 전략 정확성, 리스크 관리 건전성, 수익성 영향, 백테스트 현실성

---

## Engineer 제안서 리뷰

### P-1: 전략 상세 설명 메타데이터 체계 구축

- **판정**: ✅ 동의
- **사유**: 전략 투명성은 사용자가 올바른 시점에 올바른 전략을 활성화/비활성화하는 데 필수적이다. 제안된 `docs` 구조(summary, timeframe, entry, exit, riskManagement, bestFor, warnings)는 내 제안(P13-1)과 거의 동일한 구조이며, 실무적으로 적절하다.
- **보완 사항**: `docs.timeframe`은 단순 문자열("15분봉")이 아닌, 내 제안처럼 `{ primary: '1m', effective: '20-50 candles', note: '...' }` 구조로 확장할 것을 권장한다. 이유: 모든 전략이 `candle1m`을 수신하지만 내부에서 다른 타임프레임으로 집계하는 경우가 많다(MaTrend: 1분봉 -> 4h/daily 집계, TrendlineBreakout: configurable aggregation). 단순히 "15분봉"이라고 쓰면 사용자가 MarketData의 실제 구독 타임프레임과 혼동할 수 있다.

### P-2a: 서버측 파라미터 검증 (strategyConfigValidator)

- **판정**: ✅ 동의
- **사유**: 현재 `strategyParamMeta.js`에 min/max가 정의되어 있으면서 서버에서 검증하지 않는 것은 명백한 안전 결함이다. 사용자가 `positionSizePercent: '999'`를 전송하면 ExposureGuard가 잡아주긴 하지만, 이는 방어선이 한 겹만 있다는 의미이다. 서버측 입력 검증은 **리스크 관리의 첫 번째 방어선**으로 반드시 필요하다.
- **트레이딩 관점 보완**: 검증 시 `leverage`의 max를 `strategyParamMeta`의 20이 아닌 **전략별 합리적 상한**으로 제한하는 것이 좋다. 예를 들어 GridStrategy에 20x 레버리지는 청산 위험이 극도로 높다. 전략 메타데이터에 `maxSafeLeverage` 필드를 추가하여 전략별 상한을 차별화하는 것을 고려할 것.

### P-2b: Snapshot + Atomic Replace (updateConfig)

- **판정**: ✅ 동의
- **사유**: Engineer의 분석 자체가 정확하다. Node.js 싱글스레드 특성상 실질적 레이스 컨디션은 발생하지 않지만, 불변 객체 생성 + 참조 교체 패턴은 방어적 프로그래밍으로 적절하다. `config_updated` 이벤트 발행도 SignalFilter/StrategyRouter 연동에 유용하다.
- **수익성 관점**: 설정 변경이 기존 포지션에 즉시 적용되는 문제를 Risk 1에서 언급했는데, 이는 Phase 1에서 경고 메시지로, Phase 2에서 "새 포지션부터 적용" 옵션으로 구현하는 로드맵이 합리적이다. 다만 **SL을 기존 포지션에 즉시 적용하는 것은 의도적 설계일 수 있다** (리스크 긴급 축소 시나리오). 이 동작을 무조건 차단하기보다 사용자에게 선택권을 주는 것이 맞다.

### P-2c: API 엔드포인트 강화

- **판정**: ✅ 동의
- **사유**: P-2a의 검증을 API 레이어에 적용하는 당연한 확장이다. 별도 의견 없음.

### P-3: 통합 전략 정보 API 설계

- **판정**: ✅ 동의
- **사유**: 현재 GET /strategies와 GET /status의 데이터가 분산되어 프론트엔드가 2번 호출하는 비효율이 있다. 통합 응답 구조의 `runtime` 필드(active, state, currentConfig, assignedSymbols, warmupProgress, positionCount)는 트레이딩 모니터링에 필수적인 정보이다. 특히 `currentConfig`를 응답에 포함하는 것이 중요하다 -- 사용자가 런타임에 변경한 설정이 defaultConfig과 다를 수 있기 때문이다.

### P-4: CustomStrategyStore 안전성 개선

- **판정**: ✅ 동의
- **사유**: 동기 파일 I/O가 이벤트 루프를 차단하는 것은 라이브 트레이딩 환경에서 ticker/kline 처리 지연을 유발할 수 있다. 특히 변동성이 높은 시점에 커스텀 전략 저장으로 인해 수 ms의 지연이 발생하면 슬리피지 증가로 이어진다. 비동기 전환 + 직렬화 큐 + 원자적 쓰기(tmp -> rename)는 표준 패턴이며 이견 없음.

### P-5: 전략 모듈 간 의존성 정리 (SignalPipeline 추출)

- **판정**: ⚠️ 조건부 동의
- **사유**: BotService의 `_handleStrategySignal()` 리팩토링은 코드 품질 개선이지만, **파이프라인 패턴으로의 전환은 오버엔지니어링 위험**이 있다. 현재 `_handleStrategySignal()`은 100줄 수준이고 로직이 직선적(linear)이다. 5개 Stage 클래스를 만들면 디버깅 시 호출 스택이 깊어지고, 각 Stage의 context 전달이 새로운 복잡성을 야기한다.
- **대안 제시**: Stage 클래스 분리보다 **메서드 추출(Extract Method)**로 충분하다. `_handleStrategySignal()` 내부의 논리적 블록을 `_checkGraceBlock()`, `_applySignalFilter()`, `_resolveQuantity()`, `_checkSymbolGuard()`, `_submitOrder()` 프라이빗 메서드로 추출하되, 같은 BotService 클래스 내에 유지. 이렇게 하면 가독성은 개선되면서 불필요한 추상화 레이어를 피할 수 있다.
- **Engineer가 제안한 대로 Round 14로 미루는 것에 동의**한다. Round 13에서는 더 시급한 항목이 많다.

### P-6: 전략 숨김/표시 기능

- **판정**: ⚠️ 조건부 동의
- **사유**: 18개 전략은 많아 보일 수 있으므로 UI 정리 관점에서 타당하다. 그러나 **숨긴 전략이 활성 상태이면 숨길 수 없다는 제약은 부적절**하다. 사용자가 활성 전략을 운용하면서도 UI를 깔끔하게 유지하고 싶을 수 있다. "숨김"은 UI 표시 문제이지 전략 동작 문제가 아니다.
- **보완 제안**: 활성 전략도 숨길 수 있되, 숨긴 전략 중 활성인 것은 "숨긴 전략 N개" 카운터에서 별도 표시 (예: "숨긴 전략 3개 (1개 활성 중)").
- **우선순위**: Engineer가 3순위로 놓은 것에 동의. P-1, P-2가 훨씬 더 시급하다.

### P-7: 자금관리 모듈 시각화

- **판정**: ✅ 동의
- **사유**: 제안된 탭 구조(설명/설정/자금관리/성과)는 논리적으로 잘 분리되어 있다. 특히 **"예상 최대 손실 금액 (equity * positionSize% * SL% / leverage)"** 계산을 표시하는 것은 트레이딩 교육 관점에서 매우 가치있다. 단, 이 공식은 정확하지 않다 -- 레버리지가 분모에 들어가면 안 된다.
- **수정**: 올바른 공식은 `예상 최대 손실 = equity * positionSizePercent * SL%`이다. 레버리지는 포지션 크기를 키우는 것이지 손실을 줄이는 것이 아니다. 혼동하면 사용자가 레버리지를 높여도 손실이 줄어든다고 오해할 수 있다. 이 부분은 **반드시 정확한 공식으로 수정** 필요.
- **추가 제안**: "연속 손실 시 자본 감소 시뮬레이션" 그래프는 매우 좋은 아이디어. 예를 들어 "현재 설정으로 5연패하면 자본이 X% 감소합니다"를 시각화하면 과도한 레버리지/포지션 크기의 위험성을 직관적으로 전달할 수 있다.

---

## UI/UX 제안서 리뷰

### P1: 전략 인포 카드 리디자인 (Strategy Info Card)

- **판정**: ✅ 동의
- **사유**: Quick Stats Bar(`Lev 3x | Size 3% | TP 3% | SL 2% | Max 2포지션`)는 트레이더에게 즉시 필요한 핵심 정보를 한 줄로 요약하는 훌륭한 설계이다. 카드를 펼치지 않아도 핵심 리스크 파라미터를 파악할 수 있다.
- **보완**: TP/SL이 없는 전략(ATR 기반 동적 손절 사용)에 "ATR 기반" 표시를 제안한 것은 적절하다. 추가로 **Turtle, AdaptiveRegime 등 동적 SL 전략의 경우 현재 ATR 값 기반의 "현재 추정 SL"을 계산하여 표시**하면 더 유용하다 (예: "SL ~1.8% (ATR 기반)").
- **색상 규칙**: 레버리지별 색상 코딩(1-3x 안전, 4-10x 주의, 11-20x 위험)은 직관적이며 동의.

### P2: 전략 설명 패널 (Strategy Explainer)

- **판정**: ✅ 동의
- **사유**: StrategyDetail의 기본 탭을 "개요"로 변경하는 것에 강하게 동의. 현재 기본 탭이 "포지션"인데, 전략을 처음 보는 사용자에게는 "이 전략이 무엇인가?"가 먼저이다. 3-column 카드(진입/청산/리스크) 레이아웃은 트레이딩 정보를 구조화하는 업계 표준 방식이다.
- **데이터 의존성**: 이 패널은 백엔드의 `explainer`/`docs` 데이터에 의존하므로, Engineer의 P-1과 내 P13-1이 선행되어야 한다. 이 순서 의존성을 명확히 관리해야 한다.

### P3: 모듈형 파이프라인 시각화 (Pipeline Visualizer)

- **판정**: ⚠️ 조건부 동의
- **사유**: 파이프라인 시각화 자체는 사용자의 핵심 요청("장세판단모듈 - 전략모듈 - 자금관리모듈 - 레버리지 설정")에 정확히 대응하는 좋은 아이디어이다. 그러나 **8시간이라는 예상 소요 시간 대비 실제 운용 가치를 따져야 한다**.
- **우려**: 파이프라인 시각화는 한번 이해하면 그 이후에는 잘 안 보게 된다. 오히려 **각 모듈의 "현재 상태"를 실시간으로 보여주는 것이 더 가치있다** -- 예를 들어 "장세판단: 상승추세 -> 전략 3개 활성 -> 리스크 게이트: 정상 -> 노출 15%". 제안된 디자인에 이 실시간 데이터가 이미 포함되어 있으므로 괜찮다.
- **보완**: 각 모듈 블록을 클릭하면 해당 섹션으로 스크롤하는 네비게이션 기능은 좋은 UX이다. 다만 **파이프라인을 대시보드 최상단 고정 요소(sticky header 또는 floating widget)로 만들면** 스크롤해도 전체 시스템 상태를 항상 확인할 수 있어 더 유용하다.

### P4: 모듈별 설정 패널 재구성 (Modular Config Panels)

- **판정**: ✅ 동의
- **사유**: 파라미터를 4개 모듈(진입/청산/자금관리/레버리지)로 그룹화하는 것은 트레이딩 관점에서 자연스러운 분류이다. 현재 flat 리스트는 7~15개 파라미터가 섞여 있어 어떤 파라미터가 리스크에 직접 영향을 미치는지 구분이 어렵다.
- **트레이딩 관점 보완**: 그룹 분류에서 `strategyParamMeta.js`에 `group` 필드를 추가할 때, 내 제안(P13-7)의 분류(`'signal'`, `'indicator'`, `'risk'`, `'sizing'`)와 UI 제안의 분류(`'entry'`, `'exit'`, `'risk'`, `'execution'`)를 조율해야 한다. 내 의견으로는 **5개 그룹이 적절**하다: `'entry'`(진입 조건), `'exit'`(청산 조건), `'indicator'`(지표 파라미터), `'risk'`(손절/익절), `'sizing'`(포지션 크기/레버리지). "진입"과 "지표"를 분리하는 이유: RSI 기간(지표 설정)과 RSI 과매도 임계값(진입 조건)은 성격이 다르다.
- **12시간 소요 예상은 높은 편**이다. `paramMeta`에 `group`만 추가하고, 기존 `StrategyConfigPanel`을 아코디언으로 변환하는 것은 6-8시간이면 충분할 것이다.

### P5: 프리셋 시스템 (Risk Preset Selector)

- **판정**: ⚠️ 조건부 동의
- **사유**: 초급 사용자의 과도한 레버리지 사용을 방지하는 효과가 있어 리스크 관리 관점에서 가치있다. 그러나 **프리셋 값이 전략별로 차별화되지 않는 것이 문제**이다.
- **구체적 문제점**:
  1. `aggressive` 프리셋의 `leverage: 5`가 GridStrategy에 적용되면 위험하다. Grid 전략은 여러 주문을 동시에 가지므로 5x 레버리지는 총 노출이 과도해질 수 있다.
  2. `conservative` 프리셋의 `slPercent: '1.5'`가 Supertrend에 적용되면 너무 좁은 SL로 인해 noise에 의한 빈번한 손절이 발생한다. Supertrend의 기본 SL이 2%인 이유가 있다.
  3. FundingRateStrategy는 펀딩비 주기(8h)에 맞춰 설계되었으므로, 낮은 레버리지가 오히려 기회비용을 높인다.
- **대안**: 내 제안(P13-5)처럼 **전략별 프리셋 오버라이드**를 두는 것이 합리적이다. 글로벌 프리셋(보수적/균형/공격적) + 전략별 예외 처리. UI 제안의 단순한 3개 버튼 + 내 제안의 전략별 `strategyOverrides`를 결합하면 최적이다.

### P6: 전략 비교 뷰 (Strategy Comparison Matrix)

- **판정**: ✅ 동의
- **사유**: 18개 전략 중 어떤 조합을 활성화할지 결정할 때, 나란히 비교하는 기능은 매우 유용하다. 특히 성과 데이터(총 거래, 승률, 총 PnL)를 메타데이터와 함께 표시하면 데이터 기반 의사결정이 가능해진다.
- **추가 제안**: 비교 행에 **전략 간 상관관계**(Correlation)를 추가하면 포트폴리오 다변화에 도움이 된다. 예를 들어 MaTrend와 Supertrend가 같은 레짐에서 같은 방향으로 진입한다면 둘을 동시 활성화하는 것은 리스크 분산이 안 된다. 이는 거래 이력이 축적되면 계산 가능하다 (Phase 2 고려).

### P7: 파라미터 효과 시각화 (Parameter Impact Hints)

- **판정**: ⚠️ 조건부 동의
- **사유**: 파라미터 변경의 실시간 프리뷰는 교육적 가치가 높다. 그러나 "1% 가격 변동 -> 3% 계좌 변동"과 같은 계산은 **포지션 크기(positionSizePercent)를 반영해야 정확**하다. `leverage: 3x, positionSizePercent: 5%`이면 1% 가격 변동은 전체 계좌의 `1% * 3 * 5% = 0.15%` 변동이다. 단순히 "3배"라고 표시하면 오해를 유발한다.
- **우선순위**: LOW로 설정한 것에 동의. P1, P2, P4가 훨씬 더 시급하다. Round 14 이후로 미뤄도 무방.

### P8: 파라미터 설명 데이터 추가 (paramMeta 확장)

- **판정**: ✅ 동의
- **사유**: `description`과 `group` 필드 추가는 최소 노력(3h)으로 최대 UX 개선을 가져오는 작업이다. 특히 "이 값을 높이면/낮추면 어떤 효과가 있는지"를 포함하는 것은 트레이딩 교육 관점에서 핵심적이다.
- **트레이더가 직접 작성해야 하는 부분**: 파라미터 설명은 트레이딩 전문 지식이 필요하므로, 내가 직접 작성하겠다 (다른 에이전트에게 요청하기보다). 예를 들어 `stopMultiplier`의 설명은 "ATR 대비 손절 거리 배수. 높이면 손절이 넓어져 noise에 의한 조기 손절이 줄지만, 한 번의 손실 규모가 커짐. 낮추면 반대." -- 이런 트레이딩 맥락은 코드만 봐서는 쓸 수 없다.

### P9: 전략 Explainer 정적 데이터 추가

- **판정**: ✅ 동의
- **사유**: Engineer의 P-1, 내 P13-1과 동일한 방향. 3개 에이전트 모두 이 필요성에 동의하고 있으므로, 구조를 확정하고 빠르게 진행해야 한다. UI 제안의 `explainer` 구조와 Engineer의 `docs` 구조, 내 `docs` 구조를 통합하여 하나의 최종 스키마를 확정할 필요가 있다.
- **스키마 통합 제안**: Engineer의 `docs` + 내 `docs.riskReward` + UI의 `explainer.strengths/weaknesses`를 합치면:
  ```
  docs: {
    summary, concept, timeframe: { primary, effective, note },
    entry: { long: [], short: [] },
    exit: { takeProfit, stopLoss, trailing, other: [] },
    riskReward: { typicalRR, maxDrawdownPerTrade, avgHoldingPeriod },
    strengths: [], weaknesses: [], suitableFor,
    warnings: []
  }
  ```

### P10: 모바일 반응형 설계 고려

- **판정**: ✅ 동의
- **사유**: "Desktop First"라는 원칙에 동의한다. 암호화폐 트레이딩 대시보드는 데스크톱에서 주로 사용되며, 복잡한 전략 설정을 모바일에서 하는 것은 오히려 위험하다 (터치 오류로 잘못된 값 입력 등). 모바일에서는 모니터링 위주로, 설정은 데스크톱에서 하도록 유도하는 것이 맞다.
- **우선순위**: P1~P6 완료 후 진행하는 것에 동의.

---

## 종합 의견

### 3개 에이전트의 합의점 (즉시 진행 가능)

1. **전략 설명 메타데이터(docs/explainer) 추가**: 3개 에이전트 모두 동의. 스키마를 통합 확정하고 18개 전략에 적용.
2. **서버측 config 검증**: Engineer의 P-2, 내 P13-3(레버리지 하드코딩 수정)이 결합되어야 진정한 안전성 확보.
3. **StrategyParamMeta에 group/description 추가**: 3개 에이전트 모두 동의. 가장 적은 노력으로 가장 큰 효과.
4. **통합 전략 API**: 현재 분산된 데이터를 단일 엔드포인트로 통합.

### 트레이더 관점에서 가장 시급한 항목

**수익에 직접 영향을 미치는 순서:**

1. **P13-6 MaTrend 타임프레임 버그** (내 제안, Critical): `candle1m` 수신 상태에서 `h1Count` 기반 집계가 24분을 일봉으로 오인하는 문제. **이 버그가 실제로 존재한다면 MaTrend 전략의 모든 EMA가 무의미해지므로 라이브 트레이딩에서 잘못된 시그널을 생성한다.** Engineer 제안서에서 이 문제를 다루지 않았으므로 반드시 추가해야 한다.

2. **P13-3 레버리지 하드코딩 수정** (내 제안, High): 코드 확인 결과, `maTrendStrategy.js:348` (`leverage: '3'`), `bollingerReversionStrategy.js:319` (`leverage: '3'`), `SupertrendStrategy.js:705` (`leverage: '5'`), `fundingRateStrategy.js:233` (`leverage: '3'`) 등에서 시그널에 레버리지가 리터럴로 하드코딩되어 있음을 직접 확인했다. 반면 `turtleBreakoutStrategy.js:379`, `CandlePatternStrategy.js:622`, `SwingStructureStrategy.js:366` 등은 `this.config.leverage`를 정상적으로 참조한다. **즉 전략의 약 절반이 UI에서 변경한 레버리지를 무시한다.** 이는 사용자 기대를 배반하는 심각한 불일치이다.

3. **P-2a 서버측 config 검증** (Engineer 제안, Critical): 1번, 2번 수정 후 설정 변경의 안전 울타리.

4. **P-1/P9 전략 설명 메타데이터** (합의 항목): 사용자 직접 요청 사항이며, 간접적으로 수익에 영향 (잘못된 시점의 전략 활성화 방지).

### 우려 사항

1. **총 예상 소요 시간의 현실성**: Engineer 예상 BE ~11h + FE ~6h = 17h. UI 예상 약 69h (Sprint 3~4회). 내 예상 ~32h. 이 차이가 크므로, **Round 13의 범위를 현실적으로 축소**해야 한다. 한 라운드에 모든 것을 구현하려 하면 품질이 떨어진다.

2. **Round 13 권장 범위**:
   - BE: 레버리지 하드코딩 수정(2h) + MaTrend 타임프레임 수정(3h) + config 검증(2h) + docs 메타데이터 추가(4h) + paramMeta group/description(2h) + API 통합(2h) = **~15h**
   - FE: Quick Stats Bar(6h) + 전략 설명 패널(10h) = **~16h**
   - 파이프라인 시각화, 프리셋, 비교 뷰, 모바일 반응형은 **Round 14로 이관**

3. **프리셋 값의 정확성**: UI의 글로벌 프리셋과 내 전략별 프리셋을 합의해야 한다. 프리셋이 전략 특성을 무시하면 오히려 해롭다.

4. **Engineer P-7의 손실 공식 오류**: `equity * positionSize% * SL% / leverage`는 틀렸다. 올바른 공식은 `equity * positionSizePercent * SL%`이다. 레버리지는 같은 자본으로 더 큰 포지션을 잡게 해주므로, 실제 손실은 `equity * positionSizePercent * leverage * SL%`이 맞다 (positionSizePercent가 마진 기준이 아닌 명목 기준인 경우). 이 프로젝트에서는 positionSizePercent가 마진 기준이므로 `equity * positionSizePercent * SL% * leverage`가 정확한 예상 최대 손실이다. 이 공식이 자금관리 탭에 잘못 표시되면 사용자가 리스크를 과소평가할 수 있으므로 반드시 수정해야 한다.
