# í˜ì´í¼ íŠ¸ë ˆì´ë”© & í† ë„ˆë¨¼íŠ¸ ëª¨ë“œ

## ê°œìš”

ì‹¤ì œ ìê¸ˆ ì—†ì´ ê°€ìƒ ë§¤ë§¤ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•˜ëŠ” ëª¨ë“œì…ë‹ˆë‹¤. ë‘ ê°€ì§€ í•˜ìœ„ ëª¨ë“œê°€ ìˆìŠµë‹ˆë‹¤:

| ëª¨ë“œ | í™˜ê²½ ë³€ìˆ˜ | ì„¤ëª… |
|------|-----------|------|
| **í˜ì´í¼ íŠ¸ë ˆì´ë”©** | `PAPER_TRADING=true` | ë‹¨ì¼ ê³µìœ  ê³„ì •ìœ¼ë¡œ ê°€ìƒ ë§¤ë§¤ |
| **í† ë„ˆë¨¼íŠ¸** | `PAPER_TRADING=true` + `TOURNAMENT_MODE=true` | ì „ëµë³„ ê²©ë¦¬ ê³„ì •ìœ¼ë¡œ ì„±ê³¼ ë¹„êµ |

---

## í˜ì´í¼ íŠ¸ë ˆì´ë”©

### êµ¬ì„± ìš”ì†Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ orderManager â”‚ â”€â”€â†’ â”‚ paperEngine  â”‚ â”€â”€â†’ â”‚ paperPosition    â”‚
â”‚              â”‚     â”‚ (ì£¼ë¬¸ ë§¤ì¹­)  â”‚     â”‚ Manager (í¬ì§€ì…˜) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PaperEngine â€” ê°€ìƒ ì£¼ë¬¸ ë§¤ì¹­

ì‹¤ì œ ê±°ë˜ì†Œ ëŒ€ì‹  ê°€ìƒìœ¼ë¡œ ì£¼ë¬¸ì„ ì²´ê²°í•©ë‹ˆë‹¤.

#### ì‹œì¥ê°€ ì£¼ë¬¸
```
í˜„ì¬ê°€(lastPrice) Â± ìŠ¬ë¦¬í”¼ì§€(5bps) = ì²´ê²°ê°€
ìˆ˜ìˆ˜ë£Œ = ìˆ˜ëŸ‰ Ã— ì²´ê²°ê°€ Ã— feeRate(0.06%)
```

**ìŠ¬ë¦¬í”¼ì§€ ì ìš©**:
- ë§¤ìˆ˜: `fillPrice = lastPrice Ã— (1 + 0.0005)` â†’ ë¶ˆë¦¬í•˜ê²Œ (ë†’ì€ ê°€ê²©)
- ë§¤ë„: `fillPrice = lastPrice Ã— (1 - 0.0005)` â†’ ë¶ˆë¦¬í•˜ê²Œ (ë‚®ì€ ê°€ê²©)

#### ì§€ì •ê°€ ì£¼ë¬¸
- ëŒ€ê¸°ì—´ì— ì¶”ê°€ â†’ ë§¤ í‹±ë§ˆë‹¤ ì¡°ê±´ í™•ì¸
- ì²´ê²° ì¡°ê±´: ì‹œì¥ê°€ê°€ ì§€ì •ê°€ì— ë„ë‹¬
- ì²´ê²° ì‹œ ìŠ¬ë¦¬í”¼ì§€ ì—†ìŒ (ì§€ì •ê°€ ê·¸ëŒ€ë¡œ)

#### Stop Loss ì‹œë®¬ë ˆì´ì…˜ (Sprint R5)

PaperEngineì— ê±°ë˜ì†Œ ì‚¬ì´ë“œ SL ì‹œë®¬ë ˆì´ì…˜ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤:
- `registerStopLoss({ symbol, posSide, triggerPrice, qty, strategy })`: SL ì£¼ë¬¸ ë“±ë¡
- `cancelStopLoss(symbol, posSide)`: SL ì£¼ë¬¸ ì·¨ì†Œ
- `_checkStopLossTriggers(symbol, lastPrice)`: ë§¤ í‹±ë§ˆë‹¤ SL íŠ¸ë¦¬ê±° í™•ì¸
- LONG SL: `lastPrice <= triggerPrice`, SHORT SL: `lastPrice >= triggerPrice`
- SL ì²´ê²° ì‹œ `paper:fill` (reduceOnly, reason: 'stop_loss_triggered') + `paper:sl_triggered` ì´ë²¤íŠ¸ ë°œìƒ
- `getPendingSLOrders()`: ëŒ€ê¸° ì¤‘ SL ì£¼ë¬¸ ì¡°íšŒ

#### ê¸°ë³¸ ì„¤ì •
```javascript
feeRate = '0.0006'     // 0.06% í…Œì´ì»¤ ìˆ˜ìˆ˜ë£Œ
slippageBps = '5'      // 5 bps = 0.05%
```

#### ì²´ê²°(Fill) ê°ì²´
```javascript
{
  clientOid: 'auto_xxx',
  symbol: 'BTCUSDT',
  side: 'buy',
  posSide: 'long',
  qty: '0.05',
  fillPrice: '65435.77',
  fee: '1.963',
  notional: '3271.79',
  reduceOnly: false,
  strategy: 'TurtleBreakoutStrategy',
  action: 'open_long',        // Sprint R3: ì‹œê·¸ë„ ì•¡ì…˜ í•„ë“œ ì¶”ê°€
  filledAt: 1700000000000
}
```

### PaperPositionManager â€” ê°€ìƒ í¬ì§€ì…˜ ê´€ë¦¬

#### ì´ˆê¸° ì”ê³ 
```javascript
initialBalance = '10000'  // ê¸°ë³¸ 10,000 USDT
```

#### í¬ì§€ì…˜ ìƒíƒœ
```javascript
{
  symbol: 'BTCUSDT',
  posSide: 'long',
  qty: '0.05',
  entryPrice: '65435.77',
  markPrice: '65500.00',
  unrealizedPnl: '3.21',
  leverage: '3',
  margin: '1090.60',
  strategy: 'TurtleBreakoutStrategy'  // Sprint R3: ì „ëµ í•„ë“œ ì¶”ê°€
}
```

#### ìì‚° ê³„ì‚°
```
equity = availableBalance + Î£(unrealizedPnl)
availableBalance = initialBalance + realizedPnl - ì‚¬ìš©ì¤‘ ë§ˆì§„
```

### API ì—”ë“œí¬ì¸íŠ¸

| Method | Path | ì„¤ëª… |
|--------|------|------|
| GET | `/api/paper/status` | í˜ì´í¼ ìƒíƒœ + ì”ê³  + í¬ì§€ì…˜ + ëŒ€ê¸° ì£¼ë¬¸ |
| GET | `/api/paper/positions` | ê°€ìƒ í¬ì§€ì…˜ ëª©ë¡ |
| GET | `/api/paper/orders` | ëŒ€ê¸° ì¤‘ ì§€ì •ê°€ ì£¼ë¬¸ |
| POST | `/api/paper/reset` | ì”ê³ /í¬ì§€ì…˜/ì£¼ë¬¸ ì´ˆê¸°í™” |

---

## í† ë„ˆë¨¼íŠ¸ ëª¨ë“œ

### ê°œë…

18ê°œ ì „ëµ ê°ê°ì— **ë…ë¦½ëœ ê°€ìƒ ê³„ì •**ì„ ë¶€ì—¬í•˜ì—¬ ë™ì¼ ì‹œì¥ ì¡°ê±´ì—ì„œ ì„±ê³¼ë¥¼ ë¹„êµí•©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 PaperAccountManager                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ ì „ëµ A ê³„ì •   â”‚ â”‚ ì „ëµ B ê³„ì •   â”‚ â”‚ ì „ëµ C ê³„ì •   â”‚â”‚
â”‚ â”‚ equity: 10523 â”‚ â”‚ equity: 9850  â”‚ â”‚ equity: 10100 â”‚â”‚
â”‚ â”‚ positions: 1  â”‚ â”‚ positions: 0  â”‚ â”‚ positions: 2  â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                    â”‚
â”‚ ê³µìœ : PaperEngine (ì£¼ë¬¸ ë§¤ì¹­)                      â”‚
â”‚ ê²©ë¦¬: PaperPositionManager (ê° ì „ëµ ë…ë¦½)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê²©ë¦¬ ë³´ì¥

| í•­ëª© | ê²©ë¦¬ ì—¬ë¶€ | ì„¤ëª… |
|------|-----------|------|
| ì”ê³ (equity) | ê²©ë¦¬ | ê° ì „ëµ ë…ë¦½ ê³„ì • |
| í¬ì§€ì…˜ | ê²©ë¦¬ | ì „ëµ Aì˜ í¬ì§€ì…˜ì€ Bì— ì˜í–¥ ì—†ìŒ |
| PnL | ê²©ë¦¬ | í•œ ì „ëµì˜ ì†ì‹¤ì´ ë‹¤ë¥¸ ì „ëµì— ì˜í–¥ ì—†ìŒ |
| ì£¼ë¬¸ ë§¤ì¹­ | ê³µìœ  | ë™ì¼í•œ PaperEngine ì‚¬ìš© |
| ì‹œì¥ ë°ì´í„° | ê³µìœ  | ë™ì¼í•œ ì‹œì¥ ì¡°ê±´ |

### PaperAccountManager ì£¼ìš” ë©”ì„œë“œ

```javascript
// í† ë„ˆë¨¼íŠ¸ ì‹œì‘ â€” ì „ëµë³„ ë…ë¦½ ê³„ì • ìƒì„±
startTournament(['MaTrend', 'Grid', 'Turtle'])

// ì²´ê²° ë¼ìš°íŒ… â€” fill.strategy ê¸°ì¤€ìœ¼ë¡œ í•´ë‹¹ ê³„ì •ì— ë°˜ì˜
onFill(fill) // â†’ fill.strategy === 'MaTrend' â†’ MaTrend ê³„ì •ì— ì ìš©

// ìˆœìœ„í‘œ ì¡°íšŒ
getLeaderboard()
// â†’ [{ rank, strategy, equity, pnl, pnlPercent, unrealizedPnl, positionCount }]

// ì „ëµë³„ ê³„ì • ìƒíƒœ
getStrategyAccountState('MaTrend')
// â†’ { equity, availableBalance, unrealizedPnl, positions[] }
```

### ë¦¬ë”ë³´ë“œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ìˆœìœ„ â”‚ ì „ëµ                 â”‚ ìì‚°     â”‚ PnL      â”‚ PnL%   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ¥‡ 1 â”‚ MaTrendStrategy      â”‚ 10,523   â”‚ +523.45  â”‚ +5.23% â”‚
â”‚ ğŸ¥ˆ 2 â”‚ AdaptiveRegimeStrat. â”‚ 10,100   â”‚ +100.00  â”‚ +1.00% â”‚
â”‚ ğŸ¥‰ 3 â”‚ TurtleBreakoutStrat. â”‚ 10,050   â”‚ +50.00   â”‚ +0.50% â”‚
â”‚   4  â”‚ RsiPivotStrategy     â”‚ 9,980    â”‚ -20.00   â”‚ -0.20% â”‚
â”‚   5  â”‚ GridStrategy         â”‚ 9,850    â”‚ -150.00  â”‚ -1.50% â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API ì—”ë“œí¬ì¸íŠ¸

| Method | Path | ì„¤ëª… |
|--------|------|------|
| GET | `/api/tournament/info` | í† ë„ˆë¨¼íŠ¸ ë©”íƒ€ë°ì´í„° |
| POST | `/api/tournament/start` | ì‹œì‘ (ì „ëµ ë°°ì—´ + ì´ˆê¸° ì”ê³ ) |
| POST | `/api/tournament/stop` | ì¤‘ì§€ |
| POST | `/api/tournament/reset` | ë¦¬ì…‹ (ì”ê³  ì´ˆê¸°í™”, ê±°ë˜ ì‚­ì œ ì„ íƒ) |
| GET | `/api/tournament/leaderboard` | ìˆœìœ„í‘œ + í† ë„ˆë¨¼íŠ¸ ì •ë³´ |
| GET | `/api/tournament/strategy/:name` | ì „ëµ ìƒì„¸ (ê³„ì •, í¬ì§€ì…˜, í†µê³„, ìµœê·¼ ê±°ë˜) |

#### POST /api/tournament/start ìš”ì²­

```json
{
  "strategies": [
    "MaTrendStrategy",
    "GridStrategy",
    "TurtleBreakoutStrategy",
    "AdaptiveRegimeStrategy"
  ],
  "initialBalance": "10000"
}
```

#### GET /api/tournament/strategy/:name ì‘ë‹µ

```json
{
  "success": true,
  "data": {
    "strategy": "MaTrendStrategy",
    "account": {
      "equity": "10523.45",
      "availableBalance": "8200.00",
      "unrealizedPnl": "23.45"
    },
    "positions": [
      { "symbol": "BTCUSDT", "posSide": "long", "qty": "0.05", "entryPrice": "65000", "markPrice": "65500" }
    ],
    "stats": {
      "totalTrades": 8,
      "wins": 5,
      "losses": 3,
      "winRate": "62.5"
    },
    "recentTrades": []
  }
}
```

---

## ëª¨ë“œ ì „í™˜

### ì „í™˜ ì¡°ê±´
- ë´‡ì´ **ì •ì§€ ìƒíƒœ**ì—ì„œë§Œ ì „í™˜ ê°€ëŠ¥
- ì‹¤í–‰ ì¤‘ ì „í™˜ ì‹œë„ ì‹œ 400 ì—ëŸ¬

### ì „í™˜ ë°©ë²•

**API**:
```javascript
// ë¼ì´ë¸Œ â†’ í˜ì´í¼
POST /api/bot/trading-mode { "mode": "paper" }

// í˜ì´í¼ â†’ ë¼ì´ë¸Œ
POST /api/bot/trading-mode { "mode": "live" }
```

**í”„ë¡ íŠ¸ì—”ë“œ**: TradingModeToggle ì»´í¬ë„ŒíŠ¸ë¡œ í† ê¸€

### ëª¨ë“œë³„ ì°¨ì´

| í•­ëª© | ë¼ì´ë¸Œ ëª¨ë“œ | í˜ì´í¼ ëª¨ë“œ |
|------|------------|------------|
| ì£¼ë¬¸ ì‹¤í–‰ | Bitget ì‹¤ì œ ê±°ë˜ | PaperEngine ê°€ìƒ ë§¤ì¹­ |
| í¬ì§€ì…˜ ê´€ë¦¬ | Bitget WS + REST | PaperPositionManager |
| ìê¸ˆ | ì‹¤ì œ ê³„ì • ì”ê³  | ê°€ìƒ ì”ê³  (ê¸°ë³¸ 10,000) |
| ë°±í…ŒìŠ¤íŠ¸ ì ‘ê·¼ | ë¶ˆê°€ | ê°€ëŠ¥ |
| í† ë„ˆë¨¼íŠ¸ ì ‘ê·¼ | ë¶ˆê°€ | ê°€ëŠ¥ |
| ë¦¬ìŠ¤í¬ | ì‹¤ì œ ì†ì‹¤ ìœ„í—˜ | ì†ì‹¤ ì—†ìŒ |
